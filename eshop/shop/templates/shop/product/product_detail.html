{% extends 'shop/base.html' %}
{% load thumbnail %}

{% block title %}
    {{ product.name }}
{% endblock %}

{% block content %}
<div class="container py-5">
    {# Product header #}
    <div class="text-center mb-5">
        <h2 class="fw-bold">{{ product.name }}</h2>
        <hr class="w-25 mx-auto opacity-75">
    </div>

    {# Product main section #}
    <div class="row justify-content-center align-items-start g-5">
        {# Left column: image and carousel #}
        <div class="col-lg-6">
            <div class="card border-0 shadow-sm rounded-4 overflow-hidden">
                {% if videos or images %}
                <div id="carousel" class="carousel slide" data-bs-ride="false">
                    <div class="carousel-inner">
                       <div class="carousel-item active">
                            {% thumbnail product.image 800x600 as im %}
                            <img src="{{ im.url }}" class="d-block w-100 object-fit-cover" alt="Product image">
                        </div>
                        {% for video in videos %}
                            <div class="carousel-item">
                                <div class="ratio ratio-16x9 bg-light">
                                    <iframe
                                        src="{{ video.content }}"
                                        title="Product video"
                                        frameborder="0"
                                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                        referrerpolicy="strict-origin-when-cross-origin"
                                        allowfullscreen
                                        class="rounded-4">
                                    </iframe>
                                </div>
                            </div>
                        {% endfor %}

                        {% for image in images %}
                            <div class="carousel-item {% if forloop.first and not videos %}active{% endif %}">
                                {% thumbnail image.content 800x600 as im %}
                                <img src="{{ im.url }}" class="d-block w-100 object-fit-cover" alt="Product image">
                            </div>
                        {% endfor %}
                    </div>

                    {# Controls #}
                    <button class="carousel-control-prev h-50 align-self-center" type="button" data-bs-target="#carousel" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon"></span>
                        <span class="visually-hidden">Previous</span>
                    </button>
                    <button class="carousel-control-next h-50 align-self-center" type="button" data-bs-target="#carousel" data-bs-slide="next">
                        <span class="carousel-control-next-icon"></span>
                        <span class="visually-hidden">Next</span>
                    </button>
                </div>
                {% else %}
                    {% thumbnail product.image 600x400 as im %}
                    <img src="{{ im.url }}" class="img-fluid rounded-4" alt="{{ product.name }}">

                {% endif %}
            </div>
        </div>

        {# Right column: description, price, form #}
        <div class="col-lg-5">
            <div class="card border-0 shadow-sm rounded-4 p-4">
                {# Description #}
                <div class="mb-4">
                    <h5 class="fw-semibold text-secondary mb-2">Description</h5>
                    <p class="text-muted" id="description">{{ product.description|linebreaks }}</p>
                </div>

                {# Price #}
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <span class="badge bg-light text-dark border">In stock</span>
                    <span class="fw-bold fs-4 text-primary">${{ product.price }}</span>
                    
                </div>

                {# Add to cart #}
                <form action="{% url 'cart:add_cart' product.id %}" class="text-end" method="post">
                    {% csrf_token %}
                    {{ cart_form }}
                    <button type="submit" class="btn btn-primary w-100 py-2 fw-semibold rounded-3 mt-3">
                        <i class="bi bi-cart-plus me-2"></i>Add to cart
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block domready %}
    const carouselElement = document.getElementById('carousel');
    if (carouselElement) {
        new bootstrap.Carousel(carouselElement, { interval: false });
    }
{% endblock %}
